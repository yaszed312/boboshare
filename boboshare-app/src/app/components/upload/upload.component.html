<div class="upload-container">
  <!-- Test Section - Remove this later -->
  <div style="background: #e3f2fd; padding: 15px; margin-bottom: 20px; border-radius: 8px; border: 2px solid #2196f3;">
    <h3 style="color: #1976d2; margin: 0 0 10px 0;">üß™ Component Test Section</h3>
    <p style="margin: 5px 0;"><strong>Auto Collection URL:</strong> {{ autoCollectionUrl || 'EMPTY' }}</p>
    <p style="margin: 5px 0;"><strong>Upload Results Count:</strong> {{ uploadResults.length }}</p>
    <p style="margin: 5px 0;"><strong>Selected Files Count:</strong> {{ selectedFiles.length }}</p>
    <button (click)="generateAutoCollectionUrl()" style="background: #2196f3; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-right: 10px;">
      Generate Test URL
    </button>
    <button (click)="forceGenerateUrl()" style="background: #4caf50; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-right: 10px;">
      Force Generate
    </button>
    <button (click)="testComponent()" style="background: #ff9800; color: white; border: none; padding: 8px 16px; border-radius: 4px;">
      Test Component
    </button>
  </div>

  <div class="upload-header">
    <h2>Share Your Daily Moments</h2>
    <p>Upload photos or videos to share with your friends via unique URLs</p>
  </div>

  <div class="upload-area" 
       [class.dragover]="isDragOver"
       (dragover)="onDragOver($event)"
       (dragleave)="onDragLeave($event)"
       (drop)="onDrop($event)">
    
    <div class="upload-content" *ngIf="!selectedFiles.length">
      <div class="upload-icon">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 16L12 8M12 8L15 11M12 8L9 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M3 15V16C3 18.8284 3 20.2426 3.87868 21.1213C4.75736 22 6.17157 22 9 22H15C17.8284 22 19.2426 22 20.1213 21.1213C21 20.2426 21 18.8284 21 16V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h3>Drag & Drop Files Here</h3>
      <p>or click to browse</p>
      <input type="file" 
             #fileInput 
             multiple 
             accept="image/*,video/*" 
             (change)="onFileSelected($event)"
             class="file-input">
      <button class="browse-btn" (click)="fileInput.click()">Browse Files</button>
    </div>

    <div class="file-preview" *ngIf="selectedFiles.length">
      <div class="preview-header">
        <h3>Selected Files ({{ selectedFiles.length }})</h3>
        <button class="clear-btn" (click)="clearFiles()">Clear All</button>
      </div>
      
      <div class="file-grid">
        <div class="file-item" *ngFor="let file of selectedFiles; let i = index">
          <div class="file-preview-content">
            <img *ngIf="file.type.startsWith('image/')" 
                 [src]="file.preview" 
                 [alt]="file.name"
                 class="preview-image">
            <video *ngIf="file.type.startsWith('video/')" 
                   [src]="file.preview" 
                   class="preview-video" 
                   muted>
            </video>
            <div class="file-info">
              <p class="file-name">{{ file.name }}</p>
              <p class="file-size">{{ formatFileSize(file.size) }}</p>
            </div>
            <button class="remove-btn" (click)="removeFile(i)">√ó</button>
          </div>
        </div>
      </div>

      <div class="upload-actions">
        <button class="upload-btn" 
                [disabled]="isUploading" 
                (click)="uploadFiles()">
          <span *ngIf="!isUploading">Upload & Generate Links</span>
          <span *ngIf="isUploading">Uploading...</span>
        </button>
      </div>
    </div>
  </div>

  <div class="upload-results" *ngIf="uploadResults.length">
    <h3>Upload Results</h3>
    
    <!-- Individual File Links -->
    <div class="individual-links-section">
      <h4>Individual File Links</h4>
      <div class="results-list">
        <div class="result-item" *ngFor="let result of uploadResults">
          <div class="result-content">
            <div class="result-preview">
              <img *ngIf="result.type === 'image'" [src]="result.url" [alt]="result.name">
              <video *ngIf="result.type === 'video'" [src]="result.url" muted></video>
            </div>
            <div class="result-info">
              <h5>{{ result.name }}</h5>
              <p class="share-url">Share URL: <a [href]="result.shareUrl" target="_blank">{{ result.shareUrl }}</a></p>
              <div class="result-actions">
                <button class="copy-btn" (click)="copyToClipboard(result.shareUrl)">
                  Copy Link
                </button>
                <button class="add-to-collection-btn" (click)="addToCollection(result)">
                  Add to Collection
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Auto-Generated Collection URL -->
    <div class="auto-collection-section">
      <h4>üéØ Share All Files Together</h4>
      <p class="auto-collection-description">Single URL to share all {{ uploadResults.length }} files at once</p>
      
      <div class="auto-collection-url" *ngIf="autoCollectionUrl">
        <div class="url-display">
          <span class="url-label">Collection Share URL:</span>
          <a [href]="autoCollectionUrl" target="_blank" class="collection-url-link">{{ autoCollectionUrl }}</a>
        </div>
        <div class="auto-collection-actions">
          <button class="copy-collection-btn" (click)="copyToClipboard(autoCollectionUrl)">
            üìã Copy Collection URL
          </button>
          <button class="save-collection-btn" (click)="saveAutoCollection()">
            üíæ Save as Named Collection
          </button>
        </div>
      </div>
      
      <div class="auto-collection-url" *ngIf="!autoCollectionUrl">
        <div class="url-display">
          <span class="url-label">Collection Share URL:</span>
          <p style="color: #ffd700; font-style: italic;">No collection URL generated yet</p>
        </div>
        <div class="auto-collection-actions">
          <button class="copy-collection-btn" (click)="generateAutoCollectionUrl()" style="background: #ff6b6b;">
            üîß Generate Collection URL Now
          </button>
        </div>
      </div>
      
      <div class="auto-collection-preview">
        <h5>Files in this collection:</h5>
        <div class="collection-files-grid">
          <div class="collection-file-item" *ngFor="let result of uploadResults">
            <img *ngIf="result.type === 'image'" [src]="result.url" [alt]="result.name">
            <video *ngIf="result.type === 'video'" [src]="result.url" muted></video>
            <span class="file-name">{{ result.name }}</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Debug info (remove this later) -->
    <div class="debug-info" style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px;">
      <p><strong>Debug Info:</strong></p>
      <p>Upload Results: {{ uploadResults.length }}</p>
      <p>Auto Collection URL: {{ autoCollectionUrl || 'Not generated' }}</p>
      <p>Is Uploading: {{ isUploading }}</p>
      <button (click)="generateAutoCollectionUrl()" style="background: #007bff; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin: 5px;">
        Test Generate URL
      </button>
      <button (click)="forceGenerateUrl()" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin: 5px;">
        Force Generate URL
      </button>
    </div>
    
    <!-- Manual Collection Options -->
    <div class="collection-section">
      <h4>üìÅ Manage Collections</h4>
      <p class="collection-description">Add files to existing collections or create new ones</p>
      
      <div class="collection-options">
        <div class="collection-selector">
          <label for="collectionSelect">Add to existing collection:</label>
          <select id="collectionSelect" class="collection-select" [(ngModel)]="selectedCollectionId">
            <option value="">Select a collection...</option>
            <option *ngFor="let collection of collections" [value]="collection.id">
              {{ collection.name }} ({{ collection.files.length }} files)
            </option>
          </select>
          <button class="add-all-btn" 
                  [disabled]="!selectedCollectionId" 
                  (click)="addAllToCollection()">
            Add to Collection
          </button>
        </div>
        
        <div class="create-new-collection">
          <p>Or create a new collection:</p>
          <div class="new-collection-form">
            <input type="text" 
                   [(ngModel)]="newCollectionName" 
                   placeholder="Collection name"
                   class="collection-name-input">
            <button class="create-collection-btn" 
                    [disabled]="!newCollectionName.trim()" 
                    (click)="createAndAddToCollection()">
              Create & Add All
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
